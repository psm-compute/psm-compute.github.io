<!DOCTYPE html>
<html class="no-js" lang="en" data-content_root="./">
<head>
    <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>Jean-Zay tips &mdash; PSM tips and tricks page</title>
    
    <link rel="stylesheet" type="text/css" href="_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="_static/dist/theme.css?v=310cf088" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
            <link rel="index" title="Index" href="genindex.html" />
            <link rel="search" title="Search" href="search.html" />
            <link rel="top" title="PSM tips and tricks page" href="#" />
    </head>
<body>
    <script type="text/javascript" src="_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="index.html"
                        title="Wagtail"
                        class="logo navbar-brand"
                    >
                        <img src="_static/img/wagtail-logo-circle.svg" width="45" height="59" alt="Wagtail"
                            class="logo-img"
                        />
                        PSM tips
                    </a>
                
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oar.html">OAR tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="lammps.html">LAMMPS tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="git.html">GIT tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="vpn.html">VPN tips</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributors:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sphinx.html">Sphinx tips</a></li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="index.html">Docs</a></li>
        <li class="breadcrumb-item active" aria-current="page">Jean-Zay tips</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="https://github.com/psm-compute/psm-compute.github.io/tree/main/docs/source/JeanZay.rst" rel="nofollow">
        <span class="btn-icon"><span class="fab fa-github"></span></span>
        <span class="btn-text">Edit on GitHub</span>
    </a>
    <a class="btn btn-sm btn-light text-decoration-none" href="_sources/JeanZay.rst.txt" rel="nofollow">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <section id="jean-zay-tips">
<h1>Jean-Zay tips<a class="headerlink" href="#jean-zay-tips" title="Link to this heading">¶</a></h1>
<section id="lammps">
<h2>LAMMPS<a class="headerlink" href="#lammps" title="Link to this heading">¶</a></h2>
<p>Examples of sbatch job scripts are provided to run LAMMPS on CPU only and on both CPU and GPU. It is not always beneficial to use all available GPUs and CPUs on a node. For instance, tests conducted with a solid polymer electrolyte box containing 22,840 atoms, using the PPPM solver, SHAKE algorithm, and an external field, demonstrated that the optimal configuration was 1 GPU and 8 CPU cores. Using additional resources negatively impacted the calculation performance.</p>
<p>CPU example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --nodes=1               # Number of Nodes</span>
<span class="c1">#SBATCH --ntasks-per-node=32    # Number of MPI tasks per node</span>
<span class="c1">#SBATCH --cpus-per-task=1       # Number of OpenMP threads</span>
<span class="c1">#SBATCH --hint=nomultithread    # Disable hyperthreading</span>
<span class="c1">#SBATCH --job-name=JOB_NAME        # Jobname</span>
<span class="c1">#SBATCH --output=%x.o%j         # Output file %x is the jobname, %j the jobid</span>
<span class="c1">#SBATCH --error=%x.o%j          # Error file</span>
<span class="c1">#SBATCH --time=20:00:00         # Expected runtime HH:MM:SS (max 100h)</span>
<span class="c1">#SBATCH --account=&lt;account&gt;@cpu       # To specify cpu accounting: &lt;account&gt; = echo $IDRPROJ</span>
<span class="c1">##SBATCH --partition=cpu_p1            # To specify partition (see IDRIS web site for more info)</span>
<span class="c1">##SBATCH --qos=qos_cpu-dev      # Uncomment for job requiring less than 2 hours</span>
<span class="c1">##SBATCH --qos=qos_cpu-t4      # Uncomment for job requiring more than 20h (up to 4 nodes)</span>

<span class="c1"># Cleans out the modules loaded in interactive and inherited by default</span>
module<span class="w"> </span>purge

<span class="c1"># Load the module</span>

module<span class="w"> </span>load<span class="w"> </span>lammps/20230328-mpi

<span class="c1"># Execute commands</span>
srun<span class="w"> </span>lmp<span class="w"> </span>-i<span class="w"> </span><span class="k">in</span>.run
</pre></div>
</div>
<p>GPU example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --nodes=1               # Number of Nodes</span>
<span class="c1">#SBATCH --ntasks-per-node=8</span>
<span class="c1">#SBATCH --cpus-per-task=1       # Number of OpenMP threads</span>
<span class="c1">#SBATCH --gres=gpu:1</span>
<span class="c1">#SBATCH --hint=nomultithread    # Disable hyperthreading</span>
<span class="c1">#SBATCH --output=output.dat         # Output file %x is the jobname, %j the jobid</span>
<span class="c1">#SBATCH --error=error.dat          # Error file</span>
<span class="c1">#SBATCH --time=0:10:00         # Expected runtime HH:MM:SS (max 100h)</span>
<span class="c1">#SBATCH --account=&lt;account&gt;@v100       # To specify cpu accounting: &lt;account&gt; = echo $IDRPROJ</span>
<span class="c1">#SBATCH --job-name=JOB_NAME        # Jobname</span>
<span class="c1">###SBATCH --qos=qos_gpu-dev</span>
<span class="c1"># Cleans out the modules loaded in interactive and inherited by default</span>
module<span class="w"> </span>purge

<span class="c1"># Load the module</span>
module<span class="w"> </span>load<span class="w"> </span>lammps/20230802-mpi-cuda
<span class="nb">set</span><span class="w"> </span>-x
srun<span class="w"> </span>lmp<span class="w"> </span>-sf<span class="w"> </span>gpu<span class="w"> </span>-pk<span class="w"> </span>gpu<span class="w"> </span><span class="m">1</span><span class="w"> </span>-in<span class="w"> </span><span class="k">in</span>.run
</pre></div>
</div>
</section>
</section>

</main>
                        
                    </div>
                    
                    <nav class="col-12 col-lg-3 pb-4">
                        <div class="sticky-top toc page-toc" aria-labelledby="page-toc-heading">
                            <p class="font-weight-bold" id="page-toc-heading">Page contents</p>
                            <ul>
<li><a class="reference internal" href="#">Jean-Zay tips</a><ul>
<li><a class="reference internal" href="#lammps">LAMMPS</a></li>
</ul>
</li>
</ul>

                        </div>
                    </nav>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://liphy.univ-grenoble-alpes.fr">LIPhy</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://liphy.univ-grenoble-alpes.fr/fr/recherche/equipes/psm-physique-statistique-et-modelisation">PSM</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://github.com/psm-compute/psm-compute.github.io/blob/main/AUTHORS.md">AUTHORS</a></li>
                        
                    </ul>
                </nav>
            
        </div>
    </div>
        </div>
    </footer>
        <script src="_static/documentation_options.js?v=d45e8c67"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script type="text/javascript" src="_static/dist/theme.js"></script>
        <script type="text/javascript" src="_static/dist/vendor.js"></script>
        <script type="text/javascript" src="_static/searchtools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>