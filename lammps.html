<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>LAMMPS tips &mdash; PSM tips and tricks page</title>
    
    <link rel="stylesheet" type="text/css" href="_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="_static/dist/theme.css?v=ea6a6c20" />
            <link rel="index" title="Index" href="genindex.html" />
            <link rel="search" title="Search" href="search.html" />
            <link rel="top" title="PSM tips and tricks page" href="#" />
            <link rel="next" title="GIT tips" href="git.html" />
            <link rel="prev" title="OAR tips" href="oar.html" />
    </head>
<body>
    <script type="text/javascript" src="_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="index.html"
                        title="Wagtail"
                        class="logo navbar-brand"
                    >
                        <img src="_static/img/wagtail-logo-new.svg" width="45" height="59" alt="Wagtail"
                            class="logo-img"
                        />
                        PSM tips
                    </a>
                
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="oar.html">OAR tips</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">LAMMPS tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="git.html">GIT tips</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributors:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sphinx.html">Sphinx tips</a></li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="index.html">Docs</a></li>
        <li class="breadcrumb-item active" aria-current="page">LAMMPS tips</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="https://github.com/psm-compute/psm-compute.github.io/tree/main/docs/source/lammps.rst" rel="nofollow">
        <span class="btn-icon"><span class="fab fa-github"></span></span>
        <span class="btn-text">Edit on GitHub</span>
    </a>
    <a class="btn btn-sm btn-light text-decoration-none" href="_sources/lammps.rst.txt" rel="nofollow">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <section id="lammps-tips">
<h1>LAMMPS tips<a class="headerlink" href="#lammps-tips" title="Link to this heading">¶</a></h1>
<section id="choose-where-to-compile-lammps">
<h2>Choose where to compile LAMMPS<a class="headerlink" href="#choose-where-to-compile-lammps" title="Link to this heading">¶</a></h2>
<p>If the code must be accessed only by you, you can save it in your <code class="docutils literal notranslate"><span class="pre">/home/</span></code> folder on
Dahu/Bigfoot. If you want the code to be available to all the member from
your group, you can use <code class="docutils literal notranslate"><span class="pre">/bettik/PROJECTS/</span></code>. For instance, for the members of <cite>tamtam</cite>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/bettik/PROJECTS/pr-tamtam/
</pre></div>
</div>
</section>
<section id="download-lammps">
<h2>Download LAMMPS<a class="headerlink" href="#download-lammps" title="Link to this heading">¶</a></h2>
<p>From the <a href="https://www.lammps.org/download.html" target="_blank">LAMMPS</a> webpage, download the version of your choice.
For instance, from the terminal, download the last stable release:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>https://download.lammps.org/tars/lammps.tar.gz
tar<span class="w"> </span>-xzvf<span class="w"> </span>lammps.tar.gz
</pre></div>
</div>
</section>
<section id="compile-lammps-with-make">
<h2>Compile LAMMPS with make<a class="headerlink" href="#compile-lammps-with-make" title="Link to this heading">¶</a></h2>
<p>For compiling in serial, simply navidate to the <code class="docutils literal notranslate"><span class="pre">src/</span></code> folder, and type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>serial
</pre></div>
</div>
<p>For compilling in parallel, you will need to load manually openmpi and gcc using NIX:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>/applis/site/nix.sh
nix-shell<span class="w"> </span>-p<span class="w"> </span>openmpi<span class="w"> </span>-p<span class="w"> </span>gcc
</pre></div>
</div>
<p>Then, from the <code class="docutils literal notranslate"><span class="pre">src/</span></code> folder, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>mpi
</pre></div>
</div>
</section>
<section id="compile-lammps-with-cmake-using-guix-environment">
<h2>Compile LAMMPS with cmake using guix environment<a class="headerlink" href="#compile-lammps-with-cmake-using-guix-environment" title="Link to this heading">¶</a></h2>
<p>source your guix environment and install the following package(specified the openmpi version, some issues were observed on dahu cluster with openmpi 5)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">/</span><span class="n">applis</span><span class="o">/</span><span class="n">site</span><span class="o">/</span><span class="n">guix</span><span class="o">-</span><span class="n">start</span><span class="o">.</span><span class="n">sh</span>
<span class="n">guix</span> <span class="n">install</span> <span class="n">cmake</span>
<span class="n">guix</span> <span class="n">install</span> <span class="n">glibc</span><span class="o">-</span><span class="n">locales</span>
<span class="n">guix</span> <span class="n">install</span> <span class="n">gcc</span><span class="o">-</span><span class="n">toolchain</span>
<span class="n">guix</span> <span class="n">install</span> <span class="n">openmpi</span><span class="o">@</span><span class="mf">4.1.6</span>
<span class="n">guix</span> <span class="n">install</span> <span class="n">clang</span>
<span class="n">guix</span> <span class="n">install</span> <span class="n">ffmpeg</span>
</pre></div>
</div>
<p>navigate into your lammps home, create a folder <code class="docutils literal notranslate"><span class="pre">build/</span></code>. From the <code class="docutils literal notranslate"><span class="pre">build/</span></code> folder, compile LAMMPS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">build</span>
<span class="n">cd</span> <span class="n">build</span>
<span class="n">cmake</span> <span class="o">../</span><span class="n">cmake</span> <span class="o">-</span><span class="n">D</span> <span class="n">PKG_MOLECULE</span><span class="o">=</span><span class="n">on</span> <span class="o">-</span><span class="n">D</span> <span class="n">PKG_KSPACE</span><span class="o">=</span><span class="n">on</span> <span class="o">-</span><span class="n">D</span> <span class="n">PKG_RIGID</span><span class="o">=</span><span class="n">on</span>
</pre></div>
</div>
<p>It creates an executable lmp in the directory. You can add as many packages as you want and you can create different build if you need it.</p>
</section>
<section id="run-lammps">
<h2>Run LAMMPS<a class="headerlink" href="#run-lammps" title="Link to this heading">¶</a></h2>
<p>Create a bash file named <em>sub.sh</em> with the following content:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#OAR -n test</span>
<span class="c1">#OAR -l /nodes=1/cpu=1/core=4,walltime=12:00:00</span>
<span class="c1">#OAR --stdout log.out</span>
<span class="c1">#OAR --stderr log.err</span>
<span class="c1">#OAR --project tamtam</span>

<span class="c1"># Path to the LAMMPS executable</span>
<span class="nv">lmp</span><span class="o">=</span>/path/lmp_mpi

mpirun<span class="w"> </span>-np<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="si">${</span><span class="nv">lmp</span><span class="si">}</span><span class="w"> </span>-in<span class="w"> </span>input.lmp
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">input.lmp</span></code> is your LAMMPS input file, and where the project was assumed
to be <cite>tamtam</cite> (to adapt to your case). Here, 4 CPU cores are requested,
as well as a total duration of 12 hours. Then, make the file file executable with
chmod and launch it using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>chmod<span class="w"> </span>+x<span class="w"> </span>./sub.sh
oarsub<span class="w"> </span>-S<span class="w"> </span>./sub.sh
</pre></div>
</div>
<section id="launch-multiple-jobs-using-bash">
<h3>Launch multiple jobs using bash<a class="headerlink" href="#launch-multiple-jobs-using-bash" title="Link to this heading">¶</a></h3>
<p>Assuming that one has the job submission script named <em>sub.sh</em> with name <em>lmp-myvariable-0</em>,
that launch a lammps input script named <em>input.lmp</em> by passing a variable
named <em>myvariable</em> into it. Additionally, here the job ID is used as an
input for the random seed, allowing for example different initial configurations:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#OAR -n lmp-myvariable-0</span>
<span class="c1">#OAR -l /nodes=1/cpu=1/core=4,walltime=12:00:00</span>
<span class="c1">#OAR --stdout log.out</span>
<span class="c1">#OAR --stderr log.err</span>
<span class="c1">#OAR --project tamtam</span>

<span class="c1"># Path to the LAMMPS executable</span>
<span class="nv">lmp</span><span class="o">=</span>/path/lmp_mpi

<span class="nv">myvariable</span><span class="o">=</span><span class="m">0</span>

<span class="c1"># Run LAMMPS using MPI, with 4 processes, using the input from &#39;input.lmp&#39;</span>
mpirun<span class="w"> </span>-np<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="si">${</span><span class="nv">lmp</span><span class="si">}</span><span class="w"> </span>-in<span class="w"> </span>input.lmp<span class="w"> </span>-var<span class="w"> </span>nb2<span class="w"> </span><span class="si">${</span><span class="nv">myvariable</span><span class="si">}</span><span class="w"> </span>-var<span class="w"> </span>seedin<span class="w"> </span><span class="nv">$OAR_JOBID</span>
</pre></div>
</div>
<p>If one wants to launch the current job, one simply have to type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>chmod<span class="w"> </span>+x<span class="w"> </span>sub.sh
oarsub<span class="w"> </span>-S<span class="w"> </span>./sub.sh
</pre></div>
</div>
<p>and a single job with name <em>lmp-myvariable-0</em> will be send.
To launch multiple simulations with different values of <em>myvariable</em>,
say 0, 1, and 2, one can create a second bash script, named <em>multi-sub.sh</em>,
and containing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">set</span><span class="w"> </span>-e

<span class="k">for</span><span class="w"> </span>myvariable<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span>
<span class="k">do</span>
<span class="w">    </span><span class="c1"># deal with OAR -n</span>
<span class="w">    </span><span class="nv">newline</span><span class="o">=</span><span class="s1">&#39;#OAR -n lmp-myvariable-&#39;</span><span class="nv">$myvariable</span>
<span class="w">    </span><span class="nv">oldline</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span>sub.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;#OAR -n lmp-myvariable-&#39;</span><span class="k">)</span>
<span class="w">    </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="s2">&quot;</span><span class="nv">$oldline</span><span class="s2">&quot;</span><span class="s1">&#39;/c\&#39;</span><span class="s2">&quot;</span><span class="nv">$newline</span><span class="s2">&quot;</span><span class="w"> </span>sub.sh
<span class="w">    </span><span class="c1"># deal with myvariable</span>
<span class="w">    </span><span class="nv">newline</span><span class="o">=</span><span class="s1">&#39;myvariable=&#39;</span><span class="nv">$myvariable</span>
<span class="w">    </span><span class="nv">oldline</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span>sub.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;myvariable =&#39;</span><span class="k">)</span>
<span class="w">    </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="s2">&quot;</span><span class="nv">$oldline</span><span class="s2">&quot;</span><span class="s1">&#39;/c\&#39;</span><span class="s2">&quot;</span><span class="nv">$newline</span><span class="s2">&quot;</span><span class="w"> </span>sub.sh
<span class="w">    </span>chmod<span class="w"> </span>+x<span class="w"> </span>sub.sh
<span class="w">    </span>oarsub<span class="w"> </span>-S<span class="w"> </span>./sub.sh
<span class="k">done</span>
</pre></div>
</div>
<p>The <em>newline</em> command creates a new line that will replace the line
containing <em>myvariable</em> in the script sub.sh
The <em>oldline=</em> command finds the current line in sub.sh that contains ‘myvariable =’,
storing it in the variable oldline. This assumes there is exactly one such line,
otherwise the behavior may be unexpected. Then, sed is used to replace the old
line with the new line (newline) in <em>sub.sh</em>.</p>
<p>Then, simply run <em>multi-sub.sh</em> by typing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span>multi-sub.sh
</pre></div>
</div>
</section>
</section>
</section>

</main>
                        <nav aria-label="Page navigation" class="py-4 my-5 clearfix font-weight-bold border-top">
    <a class="float-left" href="oar.html" title="Previous">
        <span aria-hidden="true">←&nbsp;</span>OAR tips
    </a>
    <a class="float-right" href="git.html" title="Next">
        GIT tips <span aria-hidden="true">&nbsp;→</span>
    </a>
</nav>
                    </div>
                    
                    <nav class="col-12 col-lg-3 pb-4">
                        <div class="sticky-top toc page-toc" aria-labelledby="page-toc-heading">
                            <p class="font-weight-bold" id="page-toc-heading">Page contents</p>
                            <ul>
<li><a class="reference internal" href="#">LAMMPS tips</a><ul>
<li><a class="reference internal" href="#choose-where-to-compile-lammps">Choose where to compile LAMMPS</a></li>
<li><a class="reference internal" href="#download-lammps">Download LAMMPS</a></li>
<li><a class="reference internal" href="#compile-lammps-with-make">Compile LAMMPS with make</a></li>
<li><a class="reference internal" href="#compile-lammps-with-cmake-using-guix-environment">Compile LAMMPS with cmake using guix environment</a></li>
<li><a class="reference internal" href="#run-lammps">Run LAMMPS</a><ul>
<li><a class="reference internal" href="#launch-multiple-jobs-using-bash">Launch multiple jobs using bash</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                        </div>
                    </nav>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://liphy.univ-grenoble-alpes.fr">LIPhy</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://liphy.univ-grenoble-alpes.fr/fr/recherche/equipes/psm-physique-statistique-et-modelisation">PSM</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://github.com/psm-compute/psm-compute.github.io/blob/main/AUTHORS.md">AUTHORS</a></li>
                        
                    </ul>
                </nav>
            
            <div class="text-center">
                <p style="display: none">
                    <a class="text-light" href="https://github.com/wagtail/sphinx_wagtail_theme" rel="nofollow" target="_blank">
                        Wagtail Sphinx Theme 6.3.0
                    </a>
                </p>
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script src="_static/documentation_options.js?v=d45e8c67"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script type="text/javascript" src="_static/dist/theme.js"></script>
        <script type="text/javascript" src="_static/dist/vendor.js"></script>
        <script type="text/javascript" src="_static/searchtools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>